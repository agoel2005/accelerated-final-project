=================================================
Sinusoidal Attention Fusion Benchmark
=================================================

*** Testing hdim=512 ***

========================================
Testing Sinusoidal Attention:
  Batch size: 1, Num heads: 4
  Sequence length: 64, Hidden dim: 512
========================================

Testing FUSED V1 (table lookups)...
Testing FUSED V2 (float4 vectorization)...
Testing FUSED V3 (on-the-fly sin/cos)...
Testing FUSED V4 (cached frequencies)...
Testing FUSED V5 (float4 + __sincosf + cached freqs)...
Testing SEPARATE kernel approach...
Running CPU reference...

========================================
PERFORMANCE RESULTS
========================================
Fused V1 (table):      0.242 ms [baseline]
Fused V2 (float4):     0.161 ms  (1.51x vs V1)
Fused V3 (on-fly):     0.114 ms  (2.12x vs V1)
Fused V4 (cached freq):0.113 ms  (2.14x vs V1)
Fused V5 (v4+sincosf): 0.057 ms  (4.26x vs V1)
Separate:              0.058 ms  (4.14x vs V1)
========================================
** BEST: V5 **
========================================

Checking fused V1 vs CPU...
  Max difference: 0.000001 (within tolerance 0.050000)

Checking fused V2 vs CPU...
  Max difference: 0.000005 (within tolerance 0.050000)

Checking fused V3 vs CPU...
  Max difference: 0.000002 (within tolerance 0.050000)

Checking fused V4 vs CPU...
  Max difference: 0.000002 (within tolerance 0.050000)

Checking fused V5 vs CPU...
  Max difference: 0.000005 (within tolerance 0.050000)

Checking separate vs CPU...
  Max difference: 0.000005 (within tolerance 0.050000)

✓ ALL FUSED KERNELS PASSED

*** Testing hdim=2048 ***

========================================
Testing Sinusoidal Attention:
  Batch size: 1, Num heads: 4
  Sequence length: 64, Hidden dim: 2048
========================================

Testing FUSED V1 (table lookups)...
Testing FUSED V2 (float4 vectorization)...
Testing FUSED V3 (on-the-fly sin/cos)...
Testing FUSED V4 (cached frequencies)...
Testing FUSED V5 (float4 + __sincosf + cached freqs)...
Testing SEPARATE kernel approach...
Running CPU reference...

========================================
PERFORMANCE RESULTS
========================================
Fused V1 (table):      0.953 ms [baseline]
Fused V2 (float4):     0.621 ms  (1.53x vs V1)
Fused V3 (on-fly):     0.432 ms  (2.21x vs V1)
Fused V4 (cached freq):0.425 ms  (2.24x vs V1)
Fused V5 (v4+sincosf): 0.220 ms  (4.32x vs V1)
Separate:              0.211 ms  (4.51x vs V1)
========================================
** BEST: V5 **
========================================

Checking fused V1 vs CPU...
  Max difference: 0.000003 (within tolerance 0.050000)

Checking fused V2 vs CPU...
  Max difference: 0.000024 (within tolerance 0.050000)

Checking fused V3 vs CPU...
  Max difference: 0.000005 (within tolerance 0.050000)

Checking fused V4 vs CPU...
  Max difference: 0.000005 (within tolerance 0.050000)

Checking fused V5 vs CPU...
  Max difference: 0.000024 (within tolerance 0.050000)

Checking separate vs CPU...
  Max difference: 0.000024 (within tolerance 0.050000)

✓ ALL FUSED KERNELS PASSED

*** Testing hdim=4096 ***

========================================
Testing Sinusoidal Attention:
  Batch size: 1, Num heads: 2
  Sequence length: 32, Hidden dim: 4096
========================================

Testing FUSED V1 (table lookups)...
Testing FUSED V2 (float4 vectorization)...
Testing FUSED V3 (on-the-fly sin/cos)...
Testing FUSED V4 (cached frequencies)...
Testing FUSED V5 (float4 + __sincosf + cached freqs)...
Testing SEPARATE kernel approach...
Running CPU reference...

========================================
PERFORMANCE RESULTS
========================================
Fused V1 (table):      0.386 ms [baseline]
Fused V2 (float4):     0.258 ms  (1.49x vs V1)
Fused V3 (on-fly):     0.221 ms  (1.75x vs V1)
Fused V4 (cached freq):0.234 ms  (1.65x vs V1)
Fused V5 (v4+sincosf): 0.150 ms  (2.57x vs V1)
Separate:              0.122 ms  (3.16x vs V1)
========================================
** BEST: V5 **
========================================

Checking fused V1 vs CPU...
  Max difference: 0.000002 (within tolerance 0.050000)

Checking fused V2 vs CPU...
  Max difference: 0.000042 (within tolerance 0.050000)

Checking fused V3 vs CPU...
  Max difference: 0.000006 (within tolerance 0.050000)

Checking fused V4 vs CPU...
  Max difference: 0.000006 (within tolerance 0.050000)

Checking fused V5 vs CPU...
  Max difference: 0.000038 (within tolerance 0.050000)

Checking separate vs CPU...
  Max difference: 0.000042 (within tolerance 0.050000)

✓ ALL FUSED KERNELS PASSED

=================================================
All tests completed!
=================================================
